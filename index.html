<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Meus Investimentos</title>
<link rel="manifest" href="manifest.json">

<style>
body{font-family:-apple-system;background:#0b0f14;color:#fff;margin:0;padding:20px}
h1{font-size:24px}
.card{background:#121826;border-radius:14px;padding:16px;margin-bottom:14px}
input,select,button{width:100%;padding:10px;border-radius:10px;border:none;margin-top:6px}
button{background:#1f6fff;color:#fff;font-weight:600}
.total{font-size:26px;font-weight:bold;color:#4ade80}
.small{font-size:12px;color:#9ca3af}
.row{display:flex;gap:8px}
.row div{flex:1}
.progress{background:#1f2937;border-radius:10px;height:10px;overflow:hidden}
.bar{background:#22c55e;height:100%}
table{width:100%;font-size:11px}
td{padding:4px}
canvas{width:100%;height:140px}
.hidden{display:none}
</style>
</head>

<body>

<div id="login" class="card">
  <h1>üîê Meus Investimentos</h1>
  <p class="small">Autentique com Face ID para continuar</p>
  <button onclick="login()">Entrar</button>
</div>

<div id="app" class="hidden">

<h1>üìä Meus Investimentos</h1>

<div class="card">
  <div class="small">Total investido</div>
  <div class="total" id="total">R$ 0,00</div>
</div>

<div class="card">
  <div class="small">Definir meta por ativo</div>
  <input id="metaAtivo" placeholder="Ativo (ex: IVVB11)">
  <input id="metaValor" type="number" placeholder="Meta em R$">
  <button onclick="salvarMeta()">Salvar meta</button>
</div>

<div class="card">
  <div class="small">Metas</div>
  <div id="metas"></div>
</div>

<div class="card">
  <div class="small">Novo aporte</div>
  <input id="valor" type="number" placeholder="Valor (R$)">
  <input id="ativo" placeholder="Ativo">
  <select id="tipo">
    <option>A√ß√µes</option>
    <option>FIIs</option>
    <option>Renda Fixa</option>
    <option>Cripto</option>
    <option>ETF Internacional</option>
  </select>
  <button onclick="add()">Adicionar aporte</button>
</div>

<div class="card">
  <div class="small">Hist√≥rico</div>
  <table id="hist"></table>
</div>

</div>

<script>
let dados = JSON.parse(localStorage.getItem("dados")||"[]");
let metas = JSON.parse(localStorage.getItem("metas")||"{}");

async function login(){
 if(!window.PublicKeyCredential){
  alert("Face ID n√£o suportado");
  liberar();
  return;
 }
 try{
  await navigator.credentials.get({
   publicKey:{
    challenge:new Uint8Array(32),
    timeout:60000,
    userVerification:"required"
   }
  });
  liberar();
 }catch(e){
  alert("Autentica√ß√£o necess√°ria");
 }
}

function liberar(){
 document.getElementById("login").style.display="none";
 document.getElementById("app").classList.remove("hidden");
 render();
}

function salvar(){ localStorage.setItem("dados",JSON.stringify(dados)); }
function salvarMetas(){ localStorage.setItem("metas",JSON.stringify(metas)); }

function total(){ return dados.reduce((s,a)=>s+a.valor,0); }

function salvarMeta(){
 let a=metaAtivo.value.toUpperCase();
 let v=Number(metaValor.value);
 if(!a||!v)return;
 metas[a]=v;
 salvarMetas();
 metaAtivo.value=""; metaValor.value="";
 renderMetas();
}

function renderMetas(){
 let html="";
 Object.keys(metas).forEach(a=>{
  let atual=dados.filter(d=>d.ativo.toUpperCase()==a)
   .reduce((s,d)=>s+d.valor,0);
  let pct=Math.min(atual/metas[a]*100,100);
  html+=`
   <div class="small">${a} ‚Äî R$ ${atual.toLocaleString("pt-BR")}
   / R$ ${metas[a].toLocaleString("pt-BR")}</div>
   <div class="progress"><div class="bar" style="width:${pct}%"></div></div>
  `;
 });
 document.getElementById("metas").innerHTML=html;
}

function render(){
 totalEl.innerText="R$ "+total().toLocaleString("pt-BR",{minimumFractionDigits:2});
 hist.innerHTML=dados.slice().reverse()
 .map(d=>`<tr><td>${d.data}</td><td>${d.ativo}</td><td>${d.tipo}</td><td>R$ ${d.valor}</td></tr>`).join("");
 renderMetas();
}

function add(){
 let v=Number(valor.value);
 if(!v)return;
 dados.push({
  valor:v,
  ativo:ativo.value||"-",
  tipo:tipo.value,
  data:new Date().toLocaleDateString("pt-BR")
 });
 salvar();
 valor.value=""; ativo.value="";
 render();
}

const totalEl=document.getElementById("total");
const hist=document.getElementById("hist");
</script>

</body>
</html>
